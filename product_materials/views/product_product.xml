<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="product_normal_form_view" model="ir.ui.view">
        <field name="name">product.product.form.product.materials</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_normal_form_view" />
        <field name="arch" type="xml">
            <notebook position="inside">
                <!-- Show the notebook page only if configuration says materials
                are managed for products and/or packaging -->
                <page
                    string="Materials"
                    groups="product_materials.group_product_product_manage_product_materials,product_materials.group_product_product_manage_product_packaging_materials"
                >
                    <group
                        string="Product Material Compositions"
                        groups="product_materials.group_product_product_manage_product_materials"
                    >
                        <field
                            name="product_material_composition_ids"
                            context="{'default_type': 'product'}"
                            nolabel="1"
                        >
                            <tree string="Material Compositions">

                                <!-- consider making this configurable. currently hidden,
                                as in the current use case, the third level of materials is only needed
                                for packaging materials -->
                                <field
                                    name="product_material_sublevel_id"
                                    options="{ 'no_create': True }"
                                    groups="product_materials.group_product_product_manage_material_hierarchy"
                                    invisible="1"
                                />
                                <field
                                    name="name"
                                    groups="product_materials.group_product_product_manage_material_hierarchy"
                                />

                                <field
                                    name="product_material_id"
                                    domain="[('is_product_material', '=', True)]"
                                    options="{ 'no_create': True }"
                                />

                                <field
                                    name="product_material_class_id"
                                    options="{ 'no_create': True }"
                                    groups="product_materials.group_product_product_manage_material_hierarchy"
                                />

                                <field
                                    name="net_weight"
                                    groups="product_materials.group_product_product_manage_materials_weights"
                                />
                                <field
                                    name="net_weight_uom_id"
                                    groups="product_materials.group_product_product_manage_materials_weights"
                                />

                                <field
                                    name="recycled_percentage"
                                    groups="product_materials.group_product_product_manage_materials_recycling_percentages"
                                />

                                <field
                                    name="product_material_waste_component_id"
                                    groups="product_materials.group_product_product_manage_materials_waste"
                                    options="{ 'no_create': True }"
                                />

                                <field
                                    name="product_material_waste_endpoint_id"
                                    groups="product_materials.group_product_product_manage_materials_waste"
                                    options="{ 'no_create': True }"
                                />

                                <field name="description" />
                                <field name="type" invisible="1" />

                            </tree>

                            <form string="Material Composition">
                                <group>
                                    <group
                                        string="Material Basic Information"
                                        name="material_info"
                                    >

                                        <field
                                            name="name"
                                            groups="product_materials.group_product_product_manage_material_hierarchy"
                                        />
                                        <field
                                            name="net_weight"
                                            groups="product_materials.group_product_product_manage_materials_weights"
                                        />
                                        <field
                                            name="net_weight_uom_id"
                                            groups="product_materials.group_product_product_manage_materials_weights"
                                        />

                                        <field name="type" invisible="1" />
                                    </group>

                                    <group
                                        string="Material Classification"
                                        name="material_classification"
                                    >
                                        <!-- consider making this configurable. currently hidden,
                                        as in the current use case, the third level of materials is only needed
                                        for packaging materials -->
                                        <field
                                            name="product_material_sublevel_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_material_hierarchy"
                                            invisible="1"
                                        />

                                        <field
                                            name="product_material_id"
                                            domain="[('is_product_material', '=', True)]"
                                            options="{ 'no_create': True }"
                                        />

                                        <field
                                            name="product_material_class_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_material_hierarchy"
                                        />
                                    </group>
                                </group>

                                <group>
                                    <group
                                        string="Recyling &amp; Waste"
                                        name="recycling_and_waste_info"
                                    >
                                        <field
                                            name="recycled_percentage"
                                            groups="product_materials.group_product_product_manage_materials_recycling_percentages"
                                        />
                                        <field
                                            name="product_material_waste_component_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_materials_waste"
                                        />
                                        <field
                                            name="product_material_waste_endpoint_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_materials_waste"
                                        />
                                    </group>
                                </group>

                                <notebook>
                                    <page string="Notes">
                                        <field name="description" />
                                    </page>
                                    <page string="Attachments">
                                        <field
                                            name="attachment_ids"
                                            widget="many2many_binary"
                                        />
                                    </page>
                                </notebook>
                            </form>
                        </field>
                    </group>

                    <group
                        string="Product Packaging Material Compositions"
                        groups="product_materials.group_product_product_manage_product_packaging_materials"
                    >
                        <field
                            name="product_packaging_material_composition_ids"
                            context="{'default_type': 'product_packaging'}"
                            nolabel="1"
                        >
                            <tree string="Material Compositions">
                                <field
                                    name="name"
                                    groups="product_materials.group_product_product_manage_material_hierarchy"
                                />
                                <field
                                    name="product_material_sublevel_id"
                                    options="{ 'no_create': True }"
                                    groups="product_materials.group_product_product_manage_material_hierarchy"
                                />

                                <field
                                    name="product_material_id"
                                    domain="[('is_product_material', '=', True)]"
                                    options="{ 'no_create': True }"
                                />

                                <field
                                    name="product_material_class_id"
                                    options="{ 'no_create': True }"
                                    groups="product_materials.group_product_product_manage_material_hierarchy"
                                />

                                

                                <field
                                    name="net_weight"
                                    groups="product_materials.group_product_product_manage_materials_weights"
                                />
                                <field
                                    name="net_weight_uom_id"
                                    groups="product_materials.group_product_product_manage_materials_weights"
                                />

                                <field
                                    name="recycled_percentage"
                                    groups="product_materials.group_product_product_manage_materials_recycling_percentages"
                                />

                                <field
                                    name="product_material_waste_component_id"
                                    options="{ 'no_create': True }"
                                    groups="product_materials.group_product_product_manage_materials_waste"
                                />

                                <field
                                    name="product_material_waste_endpoint_id"
                                    options="{ 'no_create': True }"
                                    groups="product_materials.group_product_product_manage_materials_waste"
                                />

                                <field name="description" />
                                <field name="type" invisible="1" />

                            </tree>

                            <form string="Material Composition">
                                <group>
                                    <group
                                        string="Material Basic Information"
                                        name="material_info"
                                    >

                                        <field
                                            name="name"
                                            groups="product_materials.group_product_product_manage_material_hierarchy"
                                        />
                                        <field
                                            name="net_weight"
                                            groups="product_materials.group_product_product_manage_materials_weights"
                                        />
                                        <field
                                            name="net_weight_uom_id"
                                            groups="product_materials.group_product_product_manage_materials_weights"
                                        />

                                        <field name="type" invisible="1" />
                                    </group>

                                    <group
                                        string="Material Classification"
                                        name="material_classification"
                                    >
                                        <field
                                            name="product_material_sublevel_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_material_hierarchy"
                                        />

                                        <field
                                            name="product_material_id"
                                            domain="[('product_material_class_id', '=', product_material_class_id)]"
                                            options="{ 'no_create': True }"
                                        />

                                        <field
                                            name="product_material_class_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_material_hierarchy"
                                        />
                                    </group>
                                </group>

                                <group>
                                    <group
                                        string="Recyling &amp; Waste"
                                        name="recycling_and_waste_info"
                                    >
                                        <field
                                            name="recycled_percentage"
                                            groups="product_materials.group_product_product_manage_materials_recycling_percentages"
                                        />

                                        <field
                                            name="product_material_waste_component_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_materials_waste"
                                        />

                                        <field
                                            name="product_material_waste_endpoint_id"
                                            options="{ 'no_create': True }"
                                            groups="product_materials.group_product_product_manage_materials_waste"
                                        />
                                    </group>
                                </group>

                                <notebook>
                                    <page string="Notes">
                                        <field name="description" />
                                    </page>
                                    <page string="Attachments">
                                        <field
                                            name="attachment_ids"
                                            widget="many2many_binary"
                                        />
                                    </page>
                                </notebook>
                            </form>
                        </field>
                    </group>
                </page>
            </notebook>
        </field>
    </record>
</odoo>
